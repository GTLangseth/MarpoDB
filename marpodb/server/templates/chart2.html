<script>
	
	var typeColors = {	'promoter'   : 'rgb(100, 100, 0)',
						'terminator' : 'rgb(100, 0, 0)',
						'utr5'		 : 'rgb(0, 100, 150)',
						'cds'		 : 'rgb(0, 100, 0)',
						'utr3'		 : 'rgb(0, 100, 150)'};
	var features = []

	function draw(canvasName){
		var canvas = document.getElementById(canvasName);

		geneView = new Scribl(canvas, 705);
        geneView.glyph.color = "black";
        geneView.glyph.text.size = 10;
        geneView.glyph.text.font = "courier";
        geneView.glyph.text.align = "left";
   		geneView.glyph.roundness = 10;
        geneView.laneSizes = parseInt(20);
		// geneView.laneBuffer = 1;
		// geneView.laneBuffer = 10;
		geneView.scale.font.size = 12;
		geneView.tick.major.size = Math.ceil(seq.length / 1000) * 500;
		geneView.tick.minor.size = Math.ceil(seq.length / 1000) * 100;
		geneView.scale.max = Math.ceil(seq.length/geneView.tick.major.size) * geneView.tick.major.size;
		geneView.scale.min = 50;
		geneView.tick.auto = false;
		geneView.scale.size = 12;
		geneView.scale.font.size = 12;
		geneView.scale.font.color = "black";
		geneView.scale.font.size = 12;
		n = 0

		for( genedbid in genes ){
			console.log(genedbid);
			geneTrack = geneView.addTrack().addLane();
			console.log('Strand: ', genes[genedbid]['promoter'].split(':')[2])

			if (genes[genedbid]['promoter'].split(':')[2] == '1'){
				strand = '+'
			}
			else{
				strand = '-'
			}

			console.log('Strand: ', strand)


			for( type in genes[genedbid] ){

					

						coordinateStr = genes[genedbid][type];
						exonStr = coordinateStr.split(";");
						blocks = []

						minStart = 1000000;
						maxEnd = -1;

						// console.log(type, exonStr);

						for ( idx in exonStr ){
							
							exon = exonStr[idx]

							start  = parseInt(exon.split(':')[0]);
							end    = parseInt(exon.split(':')[1]);

							minStart = Math.min(minStart, start);
							maxEnd   = Math.max(maxEnd, end);

							blocks.push( new BlockArrow(type, start, end-start, strand, {'borderColor':'black'} ) );
						}

						for(i=0; i<blocks.length; i++){
							blocks[i].position -= minStart;
						}

						console.log(minStart, maxEnd)
						console.log(blocks)
						if (strand == '+'){
							newFeature = geneTrack.addFeature( new Complex(type, minStart, maxEnd - minStart, strand, blocks) ) ;
						}
						else{
							newFeature = geneTrack.addFeature( new Complex(type, seq.length - maxEnd, maxEnd - minStart, strand, blocks) );
						}

						
						newFeature.onClick = function(feature){
							
						};


						newFeature.onMouseover = function(feature){

								
							for(i=0; i<features.length; i++){
								if (features[i].uid == feature.parent.uid){
									features[i].borderWidth = 5;
								}
								else{
									features[i].borderWidth = 0;
								}
							}

							
							geneView.redraw();
						};
						
						newFeature.setColorGradient(typeColors[type], typeColors[type]);
						
						features.push(newFeature);

						n+=1;
					}
				
			
			
		}

		console.log(geneView);
		canvas.height = geneView.getHeight() + 20;
		geneView.draw();
	}

	function draworig(){
		for(i=0; i<features.length; i++){
			features[i].borderWidth = 0;
		}
		geneView.redraw();
	}

</script>