(function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var f=this.prototype;a=!0;var e=new this;a=!1;for(var g in c)e[g]="function"==typeof c[g]&&"function"==typeof f[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=f[a];var d=b.apply(this,arguments);this._super=c;return d}}(g,c[g]):c[g];d.prototype=e;d.constructor=d;d.extend=arguments.callee;return d}})();var SCRIBL={chars:{}};SCRIBL.chars.nt_color="white";SCRIBL.chars.nt_A_bg="red";SCRIBL.chars.nt_G_bg="blue";SCRIBL.chars.nt_C_bg="green";SCRIBL.chars.nt_T_bg="black";SCRIBL.chars.nt_N_bg="purple";SCRIBL.chars.nt_dash_bg="rgb(120,120,120)";SCRIBL.chars.heights=[];SCRIBL.chars.canvasHolder=document.createElement("canvas");
var Scribl=Class.extend({init:function(a,b){this.scrolled=!1;var c;a&&(c=a.getContext("2d"));var d=this;this.width=b;this.uid=_uniqueId("chart");this.laneSizes=50;this.laneBuffer=8;this.trackBuffer=20;this.offset=void 0;this.canvas=a;this.ctx=c;this.scale={};this.scale.pretty=!0;this.scale.max=void 0;this.scale.min=void 0;this.scale.auto=!0;this.scale.userControlled=!1;this.scale.positions=[0];this.scale.off=!1;this.scale.size=15;this.scale.font={};this.scale.font.size=15;this.scale.font.color="black";
this.scale.font.buffer=10;this.glyph={};this.glyph.roundness=6;this.glyph.borderWidth=2;this.glyph.color=["#99CCFF","rgb(63, 128, 205)"];this.glyph.text={};this.glyph.text.color="black";this.glyph.text.size="12";this.glyph.text.font="courier";this.glyph.text.align="center";this.gene={};this.gene.text={};this.protein={};this.protein.text={};this.events={};this.events.hasClick=!1;this.events.hasMouseover=!1;this.events.clicks=[];this.events.mouseovers=[];this.events.added=!1;this.mouseHandler=function(a){d.handleMouseEvent(a,
"mouseover")};this.clickHandler=function(a){d.handleMouseEvent(a,"click")};this.tick={};this.tick.auto=!0;this.tick.major={};this.tick.major.size=10;this.tick.major.color="black";this.tick.minor={};this.tick.minor.size=1;this.tick.minor.color="rgb(55,55,55)";this.tick.halfColor="rgb(10,10,10)";this.tooltips={};this.tooltips.text={};this.tooltips.text.font="arial";this.tooltips.text.size=12;this.tooltips.borderWidth=1;this.tooltips.roundness=5;this.tooltips.fade=!1;this.tooltips.style="light";this.lastToolTips=
[];this.scrollable=!1;this.scrollValues=[0,void 0];this.chars={};this.chars.drawOnBuild=[];this.drawStyle="expand";this.glyphHooks=[];this.trackHooks=[];this.myMouseEventHandler=new MouseEventHandler(this);this.tracks=[]},getScaleHeight:function(){return this.scale.font.size+this.scale.size},getHeight:function(){var a=0;this.scale.off||(a+=this.getScaleHeight());for(var b=this.tracks.length,c=0;c<b;c++)a+=this.trackBuffer,a+=this.tracks[c].getHeight();return a},getFeatures:function(){for(var a=[],
b=0;b<this.tracks.length;b++)for(var c=0;c<this.tracks[b].lanes.length;c++)a=a.concat(this.tracks[b].lanes[c].features);return a},setCanvas:function(a){this.canvas=a;this.ctx=a.getContext("2d")},addScale:function(){this.scale.userControlled?this.scale.positions.push(this.tracks.length):(this.scale.positions=[this.tracks.length],this.scale.userControlled=!0)},addTrack:function(){var a=new Track(this);1==this.tracks.length&&void 0==this.tracks[0]&&(this.tracks=[]);this.tracks.push(a);return a},removeTrack:function(a){for(var b=
0;b<this.tracks.length;b++)a.uid==this.tracks[b].uid&&this.tracks.splice(b,1);delete a},loadGenbank:function(a){genbank(a,this)},loadBed:function(a){bed(a,this)},loadBam:function(a,b,c,d,f,e){var g=this,h=g.addTrack();h.status="waiting";makeBam(new BlobFetchable(a),new BlobFetchable(b),function(a,b){g.file=a;a.fetch(c,d,f,function(a,b){if(a){for(var c=0;c<a.length;c+=1)h.addFeature(new BlockArrow("bam",a[c].pos,a[c].lengthOnRef,"+",{seq:a[c].seq}));h.status="received";h.drawOnResponse&&g.redraw()}b&&
alert("error: "+b)})});return h},loadFeatures:function(a){for(var b=0;b<a.length;b++)this.addFeature(a[b])},addGene:function(a,b,c,d){return this.addFeature(new BlockArrow("gene",a,b,c,d))},addProtein:function(a,b,c,d){return this.addFeature(new BlockArrow("protein",a,b,c,d))},addFeature:function(a){(this.tracks[0]||this.addTrack()).addFeature(a);return a},slice:function(a,b,c){c=c||"inclusive";var d=this.tracks.length,f=new Scribl(this.canvas,this.width);f.scale.min=this.scale.min;f.scale.max=this.scale.max;
f.offset=this.offset;f.scale.off=this.scale.off;f.scale.pretty=this.scale.pretty;f.laneSizes=this.laneSizes;f.drawStyle=this.drawStyle;f.glyph=this.glyph;f.glyphHooks=this.glyphHooks;f.trackHooks=this.trackHooks;f.mouseHandler=this.mouseHandler;f.previousDrawStyle=this.previousDrawStyle;for(var e=0;e<d;e++){var g=this.tracks[e],h=f.addTrack();h.drawStyle=g.drawStyle;for(var k=g.lanes.length,m=0;m<k;m++)for(var n=h.addLane(),l=g.lanes[m].features,p=0;p<l.length;p++){var q=l[p].position+l[p].length,
r=l[p].position;if("inclusive"==c)r>=a&&r<=b?n.addFeature(l[p].clone()):q>a&&q<b?n.addFeature(l[p].clone()):r<a&&q>b?n.addFeature(l[p].clone()):r>a&&q<b&&n.addFeature(l[p].clone());else if("strict"==c)if(r>=a&&r<=b)if(q>a&&q<b)n.addFeature(l[p].clone());else{var u="BlockArrow"==l[p].glyphType&&"+"==l[p].strand?l[p].clone("Rect"):l[p].clone();u.length=Math.abs(b-r);n.addFeature(u)}else q>a&&q<b?(u="BlockArrow"==l[p].glyphType&&"-"==l[p].strand?l[p].clone("Rect"):l[p].clone(),u.position=a,u.length=
Math.abs(q-a),n.addFeature(u)):r<a&&q>b&&(u="BlockArrow"==l[p].glyphType?l[p].clone("Rect"):l[p].clone(),u.position=a,u.length=Math.abs(b-a),n.addFeature(u));else"exclusive"==c&&r>=a&&r<=b&&q>a&&q<b&&n.addFeature(l[p].clone())}}return f},draw:function(){var a=this.ctx,b=this.tracks;1==this.scrollable&&this.initScrollable();a.save();this.initScale();void 0==this.offset&&(this.offset=Math.ceil(a.measureText("0").width/2+10));a.save();for(var c=0;c<b.length;c++)this.scale.off||-1==this.scale.positions.indexOf(c)||
this.drawScale(),b[c].draw();this.scale.off||-1==this.scale.positions.indexOf(b.length)||this.drawScale();a.restore();this.events.added||this.registerEventListeners()},redraw:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);0<this.tracks.length&&this.draw()},initScale:function(){this.scale.pretty&&(this.tick.auto&&(this.tick.major.size=this.determineMajorTick(),this.tick.minor.size=Math.round(this.tick.major.size/10)),this.scale.auto&&(this.scale.min-=this.scale.min%this.tick.major.size,
this.scale.max=Math.round(this.scale.max/this.tick.major.size+.4)*this.tick.major.size))},drawScale:function(a){var b=this.ctx,c=b.fillStyle;a&&a.init&&this.initScale();a=this.scale.font.size+this.scale.size;var d=this.scale.font.size+2,f=this.scale.font.size+.66*this.scale.size,e=this.scale.font.size+.33*this.scale.size;b.font=this.scale.font.size+"px verdana";b.textBaseline="top";b.fillStyle=this.scale.font.color;void 0==this.offset&&(this.offset=Math.ceil(b.measureText("0").width/2+10));for(var g=
0==this.scale.min%this.tick.minor.size?this.scale.min:this.scale.min-this.scale.min%this.tick.minor.size+this.tick.minor.size;g<=this.scale.max;g+=this.tick.minor.size){b.beginPath();var h=this.pixelsToNts(g-this.scale.min)+this.offset;if(0==g%this.tick.major.size){var k=this.getTickText(g);b.textAlign="center";b.fillText(k,h,0);b.moveTo(h,a);b.lineTo(h,d);b.strokeStyle=this.tick.major.color}else b.moveTo(h,a),0==g%(this.tick.major.size/2)?(b.strokeStyle=this.tick.halfColor,b.lineTo(h,e)):(b.strokeStyle=
this.tick.minor.color,b.lineTo(h,f));b.stroke()}b.fillStyle=c;b.translate(0,this.getScaleHeight()+this.laneBuffer)},pixelsToNts:function(a){return void 0==a?this.width/(this.scale.max-this.scale.min):this.width/(this.scale.max-this.scale.min)*a},ntsToPixels:function(a){return void 0==a?1/this.pixelsToNts():a/this.width},initScrollable:function(){var a;if(!this.scrolled){a=document.createElement("div");var b=document.createElement("div"),c=document.createElement("div");c.id="scribl-zoom-slider";c.className=
"slider";c.style.cssFloat="left";c.style.height=new String(.5*this.canvas.height)+"px";c.style.margin="30px auto auto -20px";a.style.cssText=this.canvas.style.cssText;this.canvas.style.cssText="";parentWidth=parseInt(this.canvas.width)+25;a.style.width=parentWidth+"px";b.style.width=this.canvas.width+"px";b.style.overflow="auto";b.id="scroll-wrapper";this.canvas.parentNode.replaceChild(a,this.canvas);a.appendChild(c);b.appendChild(this.canvas);a.appendChild(b);jQuery(b).dragscrollable({dragSelector:"canvas:first",
acceptPropagatedEvent:!1})}var b=this.scale.max-this.scale.min,d=this.scrollValues[1]||this.scale.max-.35*b;a=void 0!=this.scrollValues[0]?this.scrollValues[0]:this.scale.max+.35*b;var f=(d-a)/document.getElementById("scroll-wrapper").style.width.split("px")[0],f=b/f||100;this.canvas.width=f;this.width=f-30;schart=this;d=(d-a)/(this.scale.max-this.scale.min)*100||1;jQuery(c).slider({orientation:"vertical",range:"min",min:6,max:100,value:d,slide:function(a,b){var c=schart.scale.max-schart.scale.min,
d=b.value/100*schart.canvas.width,f=document.getElementById("scroll-wrapper"),f=f.scrollLeft+parseInt(f.style.width.split("px")[0])/2;schart.scrollValues=[schart.scale.min+(f-d/2)/schart.canvas.width*c,schart.scale.min+(f+d/2)/schart.canvas.width*c];schart.ctx.clearRect(0,0,schart.canvas.width,schart.canvas.height);schart.draw()}});c=(a-this.scale.min)/b*this.canvas.width;document.getElementById("scroll-wrapper").scrollLeft=c;this.scrolled=!0},determineMajorTick:function(){this.ctx.font=this.scale.font.size+
"px arial";var a=this.width/(this.ctx.measureText(this.getTickTextDecimalPlaces(this.scale.max)).width+this.scale.font.buffer),a=(this.scale.max-this.scale.min)/a,b=Math.pow(10,parseInt(a).toString().length-1);this.tick.major.size=Math.ceil(a/b)*b;a=Math.pow(10,(this.tick.major.size+"").length);b=this.tick.major.size/a;.1<b&&.5>=b?b=.5:.5<b&&(b=1);return b*a},getTickText:function(a){if(!this.tick.auto)return a;var b=a;1E6<=a?(a=Math.pow(10,5),b=Math.round(b/1E6*a)/a+"m"):1E3<=a&&(a=Math.pow(10,2),
b=Math.round(b/1E3*a)/a+"k");return b},getTickTextDecimalPlaces:function(a){if(!this.tick.auto)return a;var b=a;1E6<=a?b=Math.round(b/(1E6/Math.pow(10,5)))+"m":1E3<=a&&(b=Math.round(b/(1E3/Math.pow(10,2)))+"k");return b},handleMouseEvent:function(a,b){this.myMouseEventHandler.setMousePosition(a);for(var c=this.myMouseEventHandler.mouseY,d=this.myMouseEventHandler.mouseX,f,e=0;e<this.tracks.length;e++)for(var g=0;g<this.tracks[e].lanes.length;g++){var h=this.tracks[e].lanes[g].getPixelPositionY(),
k=h+this.tracks[e].lanes[g].getHeight(),m=this.tracks[e].lanes[g].getPixelSPositionX(),n=this.tracks[e].lanes[g].getPixelEPositionX();c>=h&&c<=k&&d>=m&&d<=n&&(f=this.tracks[e].lanes[g],on=!0)}if(f){e=f.track.getDrawStyle();if("collapse"==e)this.redraw();else if("line"!=e){this.ctx.save();f.erase();this.ctx.translate(0,f.getPixelPositionY());for(f.draw();e=this.lastToolTips.pop();)this.ctx.putImageData(e.pixels,e.x,e.y);this.ctx.restore()}f="click"==b?this.events.clicks:this.events.mouseovers;
for(e=0;e<f.length;e++)f[e](this);this.myMouseEventHandler.reset(this)}else off=!0,"undefined"!==typeof on&&1==on&&1==off&&(draworig(),on=!1)},addClickEventListener:function(a){this.events.clicks.push(a)},addMouseoverEventListener:function(a){this.events.mouseovers.push(a)},removeEventListeners:function(a){"mouseover"==a?this.canvas.removeEventListener("mousemove",this.mouseHandler):"click"==a&&this.canvas.removeEventListener("click",this.clickHandler)},registerEventListeners:function(){0<this.events.mouseovers.length&&
(this.canvas.removeEventListener("mousemove",this.mouseHandler),this.canvas.addEventListener("mousemove",this.mouseHandler,!1));0<this.events.clicks.length&&(this.canvas.removeEventListener("click",this.clickHandler),this.canvas.addEventListener("click",this.clickHandler,!1));this.events.added=!0}});var Track=Class.extend({init:function(a){this.chart=a;this.lanes=[];this.ctx=a.ctx;this.uid=_uniqueId("track");this.drawStyle=void 0;this.hide=!1;this.hooks={};for(var b=0;b<a.trackHooks.length;b++)this.addDrawHook(a.trackHooks[b]);this.coverageData=[];this.maxDepth=0},addLane:function(){var a=new Lane(this.ctx,this);this.lanes.push(a);return a},addGene:function(a,b,c,d){return this.addFeature(new BlockArrow("gene",a,b,c,d))},addProtein:function(a,b,c,d){return this.addFeature(new BlockArrow("protein",
a,b,c,d))},addFeature:function(a){for(var b,c=!0,d=0;d<this.lanes.length;d++){var f=this.lanes[d].features[this.lanes[d].features.length-1],e=3/this.chart.pixelsToNts()||3;if(void 0!=f&&a.position-e>f.position+f.length){c=!1;b=this.lanes[d];break}}c&&(b=this.addLane());b.addFeature(a);return a},hide:function(){this.hide=!0},unhide:function(){this.hide=!1},getDrawStyle:function(){return this.drawStyle?this.drawStyle:this.chart.drawStyle},getHeight:function(){var a=0,b=this.lanes.length,c=this.chart.laneBuffer,
d=this.getDrawStyle();if("line"==d||"collapse"==d)b=1;for(d=0;d<b;d++)a+=c,a+=this.lanes[d].getHeight();return a-c},getPixelPositionY:function(){var a;a=this.chart.scale.off?0:this.chart.getScaleHeight()+this.chart.laneBuffer;for(var b=0;b<this.chart.tracks.length&&this.uid!=this.chart.tracks[b].uid;b++)a+=this.chart.trackBuffer,a+=this.chart.tracks[b].getHeight();return a},calcCoverageData:function(){for(var a=this.lanes,b=this.chart.scale.min,c=this.chart.scale.max,d=0;d<a.length;d++)for(var f=
0;f<a[d].features.length;f++){var e=a[d].features[f],g=e.position,h=e.getEnd();if(g>=b&&g<=c||h>=b&&h<=c)for(g=Math.round(e.getPixelPositionX()),e=Math.round(g+e.getPixelLength());g<=e;g++)this.coverageData[g]=this.coverageData[g]+1||1,this.maxDepth=Math.max(this.coverageData[g],this.maxDepth)}},erase:function(){this.chart.ctx.clearRect(0,this.getPixelPositionY(),this.getPixelPositionX(),this.chart.width,this.getHeight())},draw:function(){var a=!1,b;for(b in this.hooks)a=this.hooks[b](this)||a;if("waiting"==
this.status)this.drawOnResponse=!0;else if(!this.hide){var c=this.getDrawStyle();b=this.chart.laneSizes;var d=this.lanes,f=this.chart.laneBuffer,e=this.chart.trackBuffer,g=b+e,h=this.chart.ctx;if(!a)if(void 0==c||"expand"==c)for(b=0;b<d.length;b++)d[b].y=g,d[b].draw()&&(a=d[b].getHeight(),h.translate(0,a+f),g=g+a+f);else if("collapse"==c){g=[];for(b=0;b<d.length;b++)g=g.concat(d[b].filterFeaturesByPosition(this.chart.scale.min,this.chart.scale.max));g.sort(function(a,b){return a.position-b.position});
for(b=0;b<g.length;b++)a=g[b].length,c=g[b].name,g[b].draw(),g[b].length=a,g[b].name=c;0<d.length&&h.translate(0,d[0].getHeight()+f)}else if("line"==c){this.coverageData=[];0==this.coverageData.length&&this.calcCoverageData();g=this.maxDepth;h.beginPath();for(a=this.chart.offset;a<=this.chart.width+this.chart.offset;a++)c=this.coverageData[a]/g*b||0,c=b-c,h.lineTo(a,c);h.lineTo(this.chart.width+this.chart.offset,b);h.stroke();h.translate(0,d[0].getHeight()+f)}h.translate(0,e-f)}},addDrawHook:function(a,
b){var c=b||_uniqueId("drawHook");this.hooks[c]=a;return c},removeDrawHook:function(a){delete this.hooks[a]}});var Lane=Class.extend({init:function(a,b){this.height=void 0;this.features=[];this.ctx=a;this.track=b;this.chart=b.chart;this.uid=_uniqueId("lane")},addGene:function(a,b,c,d){return this.addFeature(new BlockArrow("gene",a,b,c,d))},addProtein:function(a,b,c,d){return this.addFeature(new BlockArrow("protein",a,b,c,d))},addFeature:function(a){a.lane=this;this.features.push(a);this.chart[a.type]||(this.chart[a.type]={text:{}});if(a.length+a.position>this.chart.scale.max||!this.chart.scale.max)this.chart.scale.max=
a.length+a.position;if(a.position<this.chart.scale.min||!this.chart.scale.min)this.chart.scale.min=a.position;return a},loadFeatures:function(a){for(var b=a.length,c=0;c<b;c++)this.addFeature(a[c])},getHeight:function(){return void 0!=this.height?this.height:this.chart.laneSizes},getPixelPositionY:function(){for(var a=this.track.getPixelPositionY(),b=this.getHeight(),c=0;c<this.track.lanes.length&&this.uid!=this.track.lanes[c].uid;c++)a+=this.track.chart.laneBuffer,a+=b;return a},getPixelSPositionX:function(){for(var a=
parseInt(this.track.chart.offset)||0,b=this.features[0].position,c=0;c<this.track.lanes.length&&this.uid!=this.track.lanes[c].uid;c++);chartpixels=this.chart.ntsToPixels();return x_pixels=b/chartpixels+a},getPixelEPositionX:function(){for(var a=parseInt(this.track.chart.offset)||0,b=this.features[0].getEnd(),c=0;c<this.track.lanes.length&&this.uid!=this.track.lanes[c].uid;c++);chartpixels=this.chart.ntsToPixels();return x_pixels=b/chartpixels+a},erase:function(){this.chart.ctx.clearRect(0,this.getPixelPositionY(),
this.track.chart.canvas.width,this.getHeight())},draw:function(){for(var a=this.track.chart.scale.min,b=this.track.chart.scale.max,c=!1,d=0;d<this.features.length;d++){var f=this.features[d].position,e=this.features[d].getEnd();if(f>=a&&f<=b||e>=a&&e<=b)this.features[d].draw(),c=!0}return c},filterFeaturesByPosition:function(a,b){for(var c=[],d=this.features.length,f=0;f<d;f++){var e=this.features[f].position,g=this.features[f].getEnd();(e>=a&&e<=b||g>=a&&g<=b)&&c.push(this.features[f])}return c}});var Tooltip=Class.extend({init:function(a,b,c,d){this.text=a;this.placement=b||"above";this.verticalOffset=c||0;for(var f in d)this[f]=d[f];this.horizontalOffset=this.horizontalOffset||0;this.ntOffset=this.ntOffset||0},fire:function(a){a=a||this.feature;this.chart=a.lane.track.chart;this.ctx=this.chart.ctx;this.draw(a,1)},draw:function(a,b){this.ctx.globalAlpha=b;var c=this.chart.tooltips.roundness,d=this.chart.tooltips.text.font,f=this.chart.tooltips.text.size; e=this.text||a.onMouseover; this.ctx.save();
this.ctx.font=f+"px "+d;var g=this.ctx.measureText(e),d=[e],h=f+10,k=g.width+10,m,n,g=0;a.seq&&(g=a.getPixelLength(),g=g/a.length*this.ntOffset);var g=a.getPixelPositionX()+this.horizontalOffset+g,l;l="below"==this.placement?a.getPixelPositionY()+a.getHeight()-this.verticalOffset:a.getPixelPositionY()-h-this.verticalOffset;a.getPixelLength();200<k&&(d=this.ctx.measureText("s").width,d=parseInt(200/d),e=ScriblWrapLines(d,e),k=210,h=e[1]*f+10,d=e[0]);k+g>this.chart.width&&(g=this.chart.width-k);"light"==
this.chart.tooltips.style?(m=this.chart.ctx.createLinearGradient(g+k/2,l,g+k/2,l+h),m.addColorStop(0,"rgb(253, 248, 196)"),m.addColorStop(.75,"rgb(253, 248, 196)"),m.addColorStop(1,"white"),n=this.chart.ctx.createLinearGradient(g+k/2,l,g+k/2,l+h),n.addColorStop(0,"black"),n.addColorStop(1,"rgb(64, 64, 64)"),this.chart.tooltips.text.color="black"):"dark"==this.chart.tooltips.style&&(m=this.chart.ctx.createLinearGradient(g+k/2,l,g+k/2,l+h),m.addColorStop(0,"rgb(64, 64, 64)"),m.addColorStop(1,"rgb(121, 121, 121)"),
n="white",this.chart.tooltips.text.color="white");this.chart.lastToolTips.push({pixels:this.ctx.getImageData(g-1,l-1,k+2,h+2),x:g-1,y:l-1});this.ctx.fillStyle=m;this.ctx.beginPath();tlc_ctrl_x=g;tlc_ctrl_y=l;tlc_lgth_x=g+c;tlc_lgth_y=l;tlc_wdth_x=g;tlc_wdth_y=l+c;blc_ctrl_x=g;blc_ctrl_y=l+h;blc_lgth_x=g+c;blc_lgth_y=l+h;blc_wdth_x=g;blc_wdth_y=l+h-c;brc_ctrl_x=g+k;brc_ctrl_y=l+h;brc_lgth_x=g+k-c;brc_lgth_y=l+h;brc_wdth_x=g+k;brc_wdth_y=l+h-c;trc_ctrl_x=g+k;trc_ctrl_y=l;trc_lgth_x=g+k-c;trc_lgth_y=
l;trc_wdth_x=g+k;trc_wdth_y=l+c;this.ctx.moveTo(tlc_lgth_x,tlc_lgth_y);this.ctx.quadraticCurveTo(tlc_ctrl_x,tlc_ctrl_y,tlc_wdth_x,tlc_wdth_y);this.ctx.lineTo(blc_wdth_x,blc_wdth_y);this.ctx.quadraticCurveTo(blc_ctrl_x,blc_ctrl_y,blc_lgth_x,blc_lgth_y);this.ctx.lineTo(brc_lgth_x,brc_lgth_y);this.ctx.quadraticCurveTo(brc_ctrl_x,brc_ctrl_y,brc_wdth_x,brc_wdth_y);this.ctx.lineTo(trc_wdth_x,trc_wdth_y);this.ctx.quadraticCurveTo(trc_ctrl_x,trc_ctrl_y,trc_lgth_x,trc_lgth_y);this.ctx.lineTo(tlc_lgth_x,tlc_lgth_y);
this.ctx.fill();this.ctx.lineWidth=this.chart.tooltips.borderWidth;this.ctx.strokeStyle=n;this.ctx.stroke();this.ctx.textBaseline="middle";this.ctx.fillStyle=this.chart.tooltips.text.color;for(c=0;c<d.length;c++)this.ctx.measureText(d[c]),this.ctx.fillText(d[c],g+5,l+f*(c+1));this.ctx.restore()}});
var MouseEventHandler=Class.extend({init:function(a){this.chart=a;this.mouseY=this.mouseX=null;this.eventElement=void 0;this.isEventDetected=!1;this.tooltip=new Tooltip("","above",4)},addEvents:function(a){var b=this.chart,c=b.ctx,d=b.myMouseEventHandler;a.onMouseover&&!b.events.hasMouseover?(b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseover),b.events.hasMouseover=!0):0<a.tooltips.length&&!b.events.hasMouseover?(b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseover),b.events.hasMouseover=
!0):a.parent&&0<a.parent.tooltips.length&&!b.events.hasMouseover?(b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseover),b.events.hasMouseover=!0):a.parent&&a.parent.onMouseover&&!b.events.hasMouseover&&(b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseover),b.events.hasMouseover=!0);a.onClick&&!b.events.hasClick?(b.addClickEventListener(b.myMouseEventHandler.handleClick),b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseStyle),b.events.hasClick=!0):a.parent&&a.parent.onClick&&
!b.events.hasClick&&(b.addClickEventListener(b.myMouseEventHandler.handleClick),b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseStyle),b.events.hasClick=!0);!d.isEventDetected&&c.isPointInPath_mozilla(d.mouseX,d.mouseY)&&(d.eventElement=a,d.isEventDetected=!0)},setMousePosition:function(a){if(null!=a){var b=this.chart.canvas.getBoundingClientRect();this.mouseX=a.clientX-b.left;this.mouseY=a.clientY-b.top}},handleClick:function(a){a=a.myMouseEventHandler.eventElement;var b;void 0!=a&&
void 0!=a.onClick?b=a.onClick:a&&a.parent&&a.parent.onClick&&(b=a.parent.onClick);b&&("string"==typeof b?window.open(b):				"function"==typeof b&&b(a))},handleMouseover:function(a){a=a.myMouseEventHandler;var b=a.eventElement;b&&void 0==b.onMouseover&&b.parent&&b.parent.onMouseover&&(b.onMouseover=b.parent.onMouseover);b&&b.onMouseover&&("string"==typeof b.onMouseover?a.tooltip.fire(b):																					  "function"==typeof b.onMouseover&&(b.onMouseover(b))/*,a.tooltip.fire(b)*/);b&&0<b.tooltips.length&&b.fireTooltips()},handleMouseStyle:function(a){var b=
a.myMouseEventHandler.eventElement;a.ctx.canvas.style.cursor=b&&void 0!=b.onClick?"pointer":b&&b.parent&&void 0!=b.parent.onClick?"pointer":"auto"},reset:function(a){a=a.myMouseEventHandler;a.mouseX=null;a.mouseY=null;a.eventElement=void 0;a.isEventDetected=null;a.elementIndexCounter=0}});
CanvasRenderingContext2D.prototype.isPointInPath_mozilla=function(a,b){if(-1!=navigator.userAgent.indexOf("Firefox")){this.save();this.setTransform(1,0,0,1,0,0);var c=this.isPointInPath(a,b);this.restore()}else c=this.isPointInPath(a,b);return c};function ScriblWrapLines(a,b){for(var c=[],d="",f=0,e=(""+b).split(" "),g=0;g<e.length;g++)e[g].length+d.length<=a?d+=" "+e[g]:""==d?(trunc1=e[g].slice(0,a-1),d+=" "+trunc1+"-",trunc2=e[g].slice(a,e[g].length),e.splice(g+1,0,trunc2),c.push(d),d="",f++):(g--,c.push(d),f++,d="");f++;c.push(d);return[c,f]}var idCounter=0;_uniqueId=function(a){var b=idCounter++;return a?a+b:b};Object.keys=Object.keys||function(a,b,c){c=[];for(b in a)c.hasOwnProperty.call(a,b)&&c.push(b);return c};
Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;0<arguments.length&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&Infinity!==d&&-Infinity!==d&&(d=(0<d||-1)*Math.floor(Math.abs(d))));if(d>=c)return-1;for(d=0<=d?d:Math.max(c-Math.abs(d),0);d<c;d++)if(d in b&&b[d]===a)return d;return-1});var CanvasToSVG={idCounter:0,convert:function(a,b,c,d){var f=a.toDataURL(),e=document.createElementNS("http://www.w3.org/2000/svg","image");e.setAttribute("id","importedCanvas_"+this.idCounter++);e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);e.setAttribute("x",c?c:0);e.setAttribute("y",d?d:0);e.setAttribute("width",a.width);e.setAttribute("height",a.height);e.imageData=a.toDataURL();b.appendChild(e)}},toXml=function(a){return $("<p/>").text(a).html()},svgToString=function(a){for(;0<
removeUnusedDefElems(););pathActions.clear(!0);$.each(a.childNodes,function(b,c){b&&8==c.nodeType&&0<=c.data.indexOf("Created with")&&a.insertBefore(c,a.firstChild)});current_group&&(leaveContext(),selectOnly([current_group]));var b=[];$(a).find("g:data(gsvg)").each(function(){for(var a=this.attributes,c=a.length,e=0;e<c;e++)"id"!=a[e].nodeName&&"style"!=a[e].nodeName||c--;0>=c&&(a=this.firstChild,b.push(a),$(this).replaceWith(a))});var c=svgToString(a,0);b.length&&$(b).each(function(){groupSvgElem(this)});
return c},svgToString=function(a,b){var c=[];if(a){var d=a.attributes,f,e,g=a.childNodes;for(e=0;e<b;e++)c.push(" ");c.push("<");c.push(a.nodeName);if("svgcontent"==a.id){e=getResolution();c.push(' width="'+e.w+'" height="'+e.h+'" xmlns="'+svgns+'"');var h={};$(a).find("*").andSelf().each(function(){$.each(this.attributes,function(a,b){var d=b.namespaceURI;d&&!h[d]&&"xmlns"!==nsMap[d]&&"xml"!==nsMap[d]&&(h[d]=!0,c.push(" xmlns:"+nsMap[d]+'="'+d+'"'))})});for(e=d.length;e--;){f=d.item(e);var k=toXml(f.nodeValue);
0===f.nodeName.indexOf("xmlns:")||""==k||-1!="width height xmlns x y viewBox id overflow".split(" ").indexOf(f.localName)||f.namespaceURI&&!nsMap[f.namespaceURI]||(c.push(" "),c.push(f.nodeName),c.push('="'),c.push(k),c.push('"'))}}else for(e=d.length-1;0<=e;e--)f=d.item(e),k=toXml(f.nodeValue),0<=["-moz-math-font-style","_moz-math-font-style"].indexOf(f.localName)||""==k||0===k.indexOf("pointer-events")||"class"===f.localName&&0===k.indexOf("se_")||(c.push(" "),"d"===f.localName&&(k=pathActions.convertPath(a,
!0)),c.push(f.nodeName),c.push('="'),c.push(k),c.push('"'));if(a.hasChildNodes()){c.push(">");b++;d=!1;for(e=0;e<g.length;e++)switch(f=g.item(e),f.nodeType){case 1:c.push("\n");c.push(svgToString(g.item(e),b));break;case 3:f=f.nodeValue.replace(/^\s+|\s+$/g,"");""!=f&&(d=!0,c.push(toXml(f)+""));break;case 8:c.push("\n"),c.push(Array(b+1).join(" ")),c.push("\x3c!--"),c.push(f.data),c.push("--\x3e")}b--;if(!d)for(c.push("\n"),e=0;e<b;e++)c.push(" ");c.push("</");c.push(a.nodeName);c.push(">")}else c.push("/>")}return c.join("")};var Glyph=Class.extend({init:function(a,b,c,d,f){this.uid=_uniqueId("feature");this.position=b;this.length=c;this.strand=d;this.type=a;this.opts={};this.name="";this.borderColor="none";this.borderWidth=void 0;this.ntLevel=4;this.tooltips=[];this.hooks={};this.addDrawHook(function(a){if(void 0!=a.ntLevel&&a.seq&&a.lane.chart.ntsToPixels()<a.ntLevel){var b=new Seq(a.type,a.position,a.length,a.seq,a.opts);b.lane=a.lane;b.ctx=a.ctx;b._draw();return!0}return!1},"ntHook");this.text={};this.text.font=void 0;
this.text.size=void 0;this.text.color=void 0;this.onMouseover=this.onClick=this.text.align=void 0;for(var e in f)this[e]=f[e],this.opts[e]=f[e]},setColorGradient:function(){if(1==arguments.length)this.color=arguments[0];else{for(var a=this.lane.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),b,c=0;b=arguments[c],c<arguments.length;c++)a.addColorStop(c/(arguments.length-1),b);this.color=a}},getPixelLength:function(){return this.lane.chart.pixelsToNts(this.length)||1},getPixelPositionX:function(){var a=
parseInt(this.lane.track.chart.offset)||0;return this.lane.track.chart.pixelsToNts(this.parent?this.position+this.parent.position-this.lane.track.chart.scale.min:this.position-this.lane.track.chart.scale.min)+a},getPixelPositionY:function(){return this.lane.getPixelPositionY()},getEnd:function(){return this.position+this.length},clone:function(a){a=a||this.glyphType;if("Rect"==a||"Line"==a)this.strand=void 0;if(this.strand){a="new "+a+'("'+this.type+'",'+this.position+","+this.length+',"'+this.strand+
'",'+JSON.stringify(this.opts)+")";a=eval(a);var b=Object.keys(this),c=0}else a="new "+a+'("'+this.type+'",'+this.position+","+this.length+","+JSON.stringify(this.opts)+")",a=eval(a),b=Object.keys(this),c=0;for(;c<b.length;c++)a[b[c]]=this[b[c]];a.tooltips=this.tooltips;a.hooks=this.hooks;return a},getAttr:function(a){a=a.split("-");for(var b=this,c=0;c<a.length;c++)b=b[a[c]];if(b)return b;if(this.parent){b=this.parent;for(c=0;c<a.length;c++)b=b[a[c]];if(b)return b}if(b=this.lane.chart[this.type]){for(c=
0;c<a.length;c++)b=b[a[c]];if(b)return b}b=this.lane.chart.glyph;for(c=0;c<a.length;c++)b=b[a[c]];if(b)return b},drawText:function(a){var b=this.lane.chart.ctx,c=this.getPixelLength(),d=this.getHeight(),f=this.getAttr("text-size"),e=this.getAttr("text-font");b.font=f+"px "+e;b.textBaseline="middle";b.fillStyle=this.getAttr("text-color");f=void 0;e=this.getAttr("text-align");"start"==e?e="+"==this.strand?"left":"right":"end"==e&&(e="+"==this.strand?"right":"left");b.textAlign=e;"left"==e?f=-135:"center"==
e?f=c/2:"right"==e&&(f=c-5);b.measureText(a);a&&""!=a&&("Complex"==this.glyphType&&(/^\d+/.exec(b.font),"center"==e&&b.measureText(a)),b.fillText(a,f,d/2))},calcRoundness:function(){var a=this.getHeight()*this.getAttr("roundness")/100;return a=(2.5<=10*a%5?5*parseInt(10*a/5)+5:5*parseInt(10*a/5))/10},isContainedWithinRect:function(a,b,c,d){var f=this.getPixelPositionY(),e=this.getPixelPositionX(),g=this.getPixelPositionX()+this.getPixelLength(),h=f+this.getHeight();return e>=a&&g<=c&&f>=b&&h<=d},
getHeight:function(){return this.lane.getHeight()},getFillStyle:function(){var a=this.getAttr("color");if(a instanceof Array){for(var b=this.lane.track.chart.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),c,d=0;c=a[d],d<a.length;d++)b.addColorStop(d/(a.length-1),c);return b}return a instanceof Function?(b=this.lane.track.chart.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),a(b)):a},getStrokeStyle:function(){var a=this.getAttr("borderColor");if("object"==
typeof a){for(var b=this.lane.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),c,d=0;c=a[d],d<a.length;d++)b.addColorStop(d/(a.length-1),c);return b}return a},isSubFeature:function(){return void 0!=this.parent},erase:function(){this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.clearRect(this.getPixelPositionX(),this.getPixelPositionY(),this.getPixelLength(),this.getHeight());this.ctx.restore()},addDrawHook:function(a,b){var c=b||_uniqueId("drawHook");this.hooks[c]=
a;return c},removeDrawHook:function(a){delete this.hooks[a]},

addTooltip:function(a,b,c,d){a=new Tooltip(a,b,c,d);a.feature=this;this.tooltips.push(a)},

fireTooltips:function(){for(var a=0;a<this.tooltips.length;a++)this.tooltips[a].fire()},

draw:function(){this.ctx=this.lane.chart.ctx;this.ctx.beginPath();/^\d+/.exec(this.ctx.font);var a=/\S+$/.exec(this.ctx.font);this.onClick=this.getAttr("onClick");this.onMouseover=this.getAttr("onMouseover");this.ctx.fillStyle=this.getFillStyle();var b=this.ctx.fillStyle,
c=this.getPixelPositionX(),d=this.getHeight();10>d?this.ctx.font="10px "+a:this.ctx.font=.9*d+"px "+a;this.ctx.translate(c,0);"-"!=this.strand||this.isSubFeature()||this.ctx.transform(-1,0,0,1,this.getPixelLength(),0);var a=!1,f;for(f in this.hooks)a=this.hooks[f](this)||a;a||this._draw();"none"!=this.borderColor&&("none"==this.color&&"Complex"==this.parent.glyphType&&this.erase(),f=this.ctx.strokeStyle,a=this.ctx.lineWidth,this.ctx.strokeStyle=this.getStrokeStyle(),this.ctx.lineWidth=this.getAttr("borderWidth"),
this.ctx.stroke(),this.ctx.strokeStyle=f,this.ctx.lineWidth=a);"none"!=this.color&&this.ctx.fill();"-"!=this.strand||this.isSubFeature()||this.ctx.transform(-1,0,0,1,this.getPixelLength(),0);"-"==this.strand?(this.ctx.transform(-1,0,0,1,this.getPixelLength(),0),this.drawText(this.getAttr("name")),this.ctx.transform(-1,0,0,1,this.getPixelLength(),0)):this.drawText(this.getAttr("name"));this.ctx.translate(-c,0);this.ctx.fillStyle=b;this.lane.chart.myMouseEventHandler.addEvents(this)},redraw:function(){this.lane.ctx.save();
this.erase;var a=this.getPixelPositionY();this.lane.ctx.translate(0,a);this.draw();this.lane.ctx.restore()}});var BlockArrow=Glyph.extend({init:function(a,b,c,d,f){this._super(a,b,c,d,f);this.slope=1;this.glyphType="BlockArrow"},_draw:function(a,b,c,d){a=a||this.ctx;b=b||this.getPixelLength();c=c||this.getHeight();d=d+1||this.calcRoundness();void 0!=d&&--d;tc_ctrl_y=tc_ctrl_x=x=y=0;tc_lgth_x=x+d;tc_lgth_y=y;tc_wdth_x=x;tc_wdth_y=y+d;bc_ctrl_x=x;bc_ctrl_y=y+c;bc_lgth_x=x+d;bc_lgth_y=y+c;bc_wdth_x=x;bc_wdth_y=y+c-d;a_b_x=x+b-d;a_t_x=x+b-d;a_max_x=x+b;t=.5;a_ctrl_x=Math.round((a_max_x-(1-t)*(1-t)*a_b_x-t*t*
a_t_x)/(2*(1-t)*t)*10)/10;a_ctrl_y=y+c/2;bs_slope=this.slope;bs_intercept=-a_ctrl_y-bs_slope*a_ctrl_x;ts_slope=-this.slope;ts_intercept=-a_ctrl_y-ts_slope*a_ctrl_x;a_b_y=-(Math.round(10*(bs_slope*a_b_x+bs_intercept))/10);a_t_y=-(Math.round(10*(ts_slope*a_t_x+ts_intercept))/10);bs_ctrl_y=y+c;bs_ctrl_x=(-bs_ctrl_y-bs_intercept)/this.slope;bs_ctrl_x<x?(new Rect(this.type,0,b))._draw(a,b,c,d):(bs_lgth_y=y+c,bs_lgth_x=bs_ctrl_x-d,bs_slpe_x=bs_ctrl_x+d,bs_slpe_y=-(Math.round(10*(bs_slope*bs_slpe_x+bs_intercept))/
10),ts_ctrl_y=y,ts_ctrl_x=(ts_ctrl_y+ts_intercept)/this.slope,ts_lgth_y=y,ts_lgth_x=ts_ctrl_x-d,ts_slpe_x=ts_ctrl_x+d,ts_slpe_y=-(Math.round(10*(ts_slope*ts_slpe_x+ts_intercept))/10),a.beginPath(),a.moveTo(tc_lgth_x,tc_lgth_y),a.quadraticCurveTo(tc_ctrl_x,tc_ctrl_y,tc_wdth_x,tc_wdth_y),a.lineTo(bc_wdth_x,bc_wdth_y),a.quadraticCurveTo(bc_ctrl_x,bc_ctrl_y,bc_lgth_x,bc_lgth_y),a.lineTo(bs_lgth_x,bs_lgth_y),a.quadraticCurveTo(bs_ctrl_x,bs_ctrl_y,bs_slpe_x,bs_slpe_y),a.lineTo(a_b_x,a_b_y),a.quadraticCurveTo(a_ctrl_x,
a_ctrl_y,a_t_x,a_t_y),a.lineTo(ts_slpe_x,ts_slpe_y),a.quadraticCurveTo(ts_ctrl_x,ts_ctrl_y,ts_lgth_x,ts_lgth_y),a.lineTo(tc_lgth_x,tc_lgth_y))}});var Rect=Glyph.extend({init:function(a,b,c,d){this._super(a,b,c,void 0,d);this.glyphType="Rect"},_draw:function(a,b,c,d){a=a||this.ctx;b=b||this.getPixelLength();c=c||this.getHeight();d=d+1||this.calcRoundness();void 0!=d&&--d;x=y=0;a.beginPath();tlc_ctrl_x=x;tlc_ctrl_y=y;tlc_lgth_x=x+d;tlc_lgth_y=y;tlc_wdth_x=x;tlc_wdth_y=y+d;blc_ctrl_x=x;blc_ctrl_y=y+c;blc_lgth_x=x+d;blc_lgth_y=y+c;blc_wdth_x=x;blc_wdth_y=y+c-d;brc_ctrl_x=x+b;brc_ctrl_y=y+c;brc_lgth_x=x+b-d;brc_lgth_y=y+c;brc_wdth_x=x+b;brc_wdth_y=
y+c-d;trc_ctrl_x=x+b;trc_ctrl_y=y;trc_lgth_x=x+b-d;trc_lgth_y=y;trc_wdth_x=x+b;trc_wdth_y=y+d;a.moveTo(tlc_lgth_x,tlc_lgth_y);a.quadraticCurveTo(tlc_ctrl_x,tlc_ctrl_y,tlc_wdth_x,tlc_wdth_y);a.lineTo(blc_wdth_x,blc_wdth_y);a.quadraticCurveTo(blc_ctrl_x,blc_ctrl_y,blc_lgth_x,blc_lgth_y);a.lineTo(brc_lgth_x,brc_lgth_y);a.quadraticCurveTo(brc_ctrl_x,brc_ctrl_y,brc_wdth_x,brc_wdth_y);a.lineTo(trc_wdth_x,trc_wdth_y);a.quadraticCurveTo(trc_ctrl_x,trc_ctrl_y,trc_lgth_x,trc_lgth_y);a.lineTo(tlc_lgth_x,tlc_lgth_y)}});var Seq=Glyph.extend({init:function(a,b,c,d,f){this.seq=d;this.insertions=[];this.fraction=1;this.fractionLevel=.3;this.glyphType="Seq";this.font="8px courier";this.chars={};this.chars.width=void 0;this.chars.height=void 0;this.chars.list="AGTCN-".split("");this._super(a,b,c,void 0,f)},_draw:function(a,b,c){var d=1;this.lane.chart.ntsToPixels()<=this.fractionLevel&&(d=this.fraction);a=a||this.ctx;b=b||this.getPixelLength();c=c||this.getHeight();var f=this.getPixelPositionX(),e=this.getPixelPositionY(),
g=SCRIBL.chars;if(!g.heights[c]){g.heights[c]=[];for(var h=0;h<this.chars.list.length;h++){var k=this.chars.list[h],m=k;"-"==k&&(m="dash");this.createChar(k,g.nt_color,g["nt_"+m+"_bg"],c)}}x=y=0;if(this.imgCanvas)a.drawImage(this.imgCanvas,f,e-c*d,b,c*d);else{a.save();a.beginPath();a.textBaseline="middle";f=a.font;h=/[\d+px]/.exec(f)+"px";a.font=h+" courier";a.fillStyle="black";a.textAlign="left";h=this.seq.length*g.heights[c].width;this.imgCanvas=document.createElement("canvas");this.imgCanvas.width=
h;this.imgCanvas.height=c;e=this.imgCanvas.getContext("2d");for(h=m=k=0;h<this.seq.length;h++){g.heights[c][this.seq[h]]||this.createChar(this.seq[h],"black","white",c);var n=this.seq[h];this.insertions[m]&&void 0!=this.insertions[m].pos&&(this.insertions[m].pos-1==h?n+="rightInsert":this.insertions[m]&&this.insertions[m].pos==h&&(n+="leftInsert",m++));e.drawImage(g.heights[c][n],k,y);k+=g.heights[c].width}a.drawImage(this.imgCanvas,x,c-c*d,b,c*d);a.font=f;a.restore()}a.beginPath();a.moveTo(0,0);
a.lineTo(b,y);a.lineTo(b,y+c);a.lineTo(x,y+c);a.lineTo(x,y);a.fillStyle="rgba(0,0,0,0)";this.lane.chart.ntsToPixels()<=this.fractionLevel?a.strokeStyle="rgba(0,0,0,1)":a.strokeStyle="rgba(0,0,0,0)";a.stroke();a.closePath()},createChar:function(a,b,c,d){var f=document.createElement("canvas"),e=f.getContext("2d"),g=d-2;e.font=g+"px courier";var h=e.measureText(a).width+2;f.height=d;f.width=h;SCRIBL.chars.heights[d].width=h;f=document.createElement("canvas");e=f.getContext("2d");e.font=g+"px courier";
f.height=d;f.width=h;var k=e.fillStyle;e.fillStyle=c;e.fillRect(0,0,h,d);e.fillStyle=b;e.textAlign="center";e.textBaseline="middle";e.fillText(a,h/2,d/2);SCRIBL.chars.heights[d][a]=f;e.fillStyle=k;f=document.createElement("canvas");e=f.getContext("2d");e.font=g+"px courier";f.height=d;f.width=h;k=e.fillStyle;e.fillStyle=c;e.fillRect(0,0,h,d);e.fillStyle="yellow";e.beginPath();e.moveTo(0,d);e.arcTo(h,d,h,0,d/2);e.lineTo(h,d);e.lineTo(0,d);e.closePath();e.fill();e.fillStyle=b;e.textAlign="center";e.textBaseline=
"middle";e.fillText(a,h/2,d/2);SCRIBL.chars.heights[d][a+"rightInsert"]=f;e.fillStyle=k;f=document.createElement("canvas");e=f.getContext("2d");e.font=g+"px courier";f.height=d;f.width=h;k=e.fillStyle;e.fillStyle=c;e.fillRect(0,0,h,d);e.fillStyle="yellow";e.beginPath();e.moveTo(h,d);e.arcTo(0,d,0,0,d/2);e.lineTo(0,d);e.lineTo(h,d);e.closePath();e.fill();e.fillStyle=b;e.textAlign="center";e.textBaseline="middle";e.fillText(a,h/2,d/2);SCRIBL.chars.heights[d][a+"leftInsert"]=f;e.fillStyle=k}});var Line=Glyph.extend({init:function(a,b,c,d){this.thickness=2;this._super(a,b,c,void 0,d);this.glyphType="Line"},_draw:function(a,b,c,d){a=a||this.ctx;b=b||this.getPixelLength();c=c||this.getHeight();x=y=0;a.beginPath();a.moveTo(x,c/2-this.thickness/2);a.lineTo(x,c/2+this.thickness/2);a.lineTo(x+b,c/2+this.thickness/2);a.lineTo(x+b,c/2-this.thickness/2)}});var Complex=Glyph.extend({init:function(a,b,c,d,f,e){this._super(a,b,c,d,e);this.slope=1;this.glyphType="Complex";this.subFeatures=f;this.line=new Line(a,0,c);this.line.parent=this;this.line.color="black";this.line.thickness=2},addSubFeature:function(a){this.subFeatures.push(a)},_draw:function(a,b,c,d){a=a||this.ctx;b||this.getPixelLength();c||this.getHeight();d+1||this.calcRoundness();x=y=0;a.translate(-this.getPixelPositionX(),0);this.line.lane=this.lane;this.line.draw();b=this.subFeatures.length;
for(c=0;c<b;c++)this.subFeatures[c].parent=this,this.subFeatures[c].lane=this.lane,this.subFeatures[c].draw();a.translate(this.getPixelPositionX(),0);a.beginPath()}});var Arrow=Glyph.extend({init:function(a,b,c,d){this._super(a,b,0,c,d);this.slope=1;this.glyphType="Arrow";this.thickness=4.6},getPixelThickness:function(){var a=this.getHeight()/2/Math.tan(Math.atan(this.slope));return this.thickness/10*a},erase:function(){var a=this.getPixelThickness();this.ctx.clearRect(-a,0,a,this.getHeight())},_draw:function(a,b,c,d){a=a||this.ctx;c=c||this.getHeight();d=d+1||this.calcRoundness();void 0!=d&&--d;b=this.getPixelThickness();x=y=0;a_b_x=x-0-d;a_t_x=x-0-d;a_max_x=
x-0;t=.5;a_ctrl_x=(a_max_x-(1-t)*(1-t)*a_b_x-t*t*a_t_x)/(2*(1-t)*t);a_ctrl_y=y+c/2;bs_slope=this.slope;bs_intercept=-a_ctrl_y-bs_slope*a_ctrl_x;ts_slope=-this.slope;ts_intercept=-a_ctrl_y-ts_slope*a_ctrl_x;a_b_y=-(bs_slope*a_b_x+bs_intercept);a_t_y=-(ts_slope*a_t_x+ts_intercept);a.beginPath();bs_ctrl_y=y+c;bs_ctrl_x=(-bs_ctrl_y-bs_intercept)/this.slope;bs_slpe_x=bs_ctrl_x+d+d;bs_slpe_y=-(bs_slope*bs_slpe_x+bs_intercept);a.moveTo(bs_slpe_x,bs_slpe_y);a.lineTo(a_b_x,a_b_y);a.quadraticCurveTo(a_ctrl_x,
a_ctrl_y,a_t_x,a_t_y);ts_ctrl_y=y;ts_ctrl_x=(ts_ctrl_y+ts_intercept)/this.slope;ts_slpe_x=ts_ctrl_x+d+d;ts_slpe_y=-(ts_slope*ts_slpe_x+ts_intercept);a.lineTo(ts_slpe_x,ts_slpe_y);var f=Math.PI-Math.abs(Math.atan(this.slope))-Math.PI/2;d=Math.sin(f)*b;f=Math.cos(f)*b;a.bezierCurveTo(ts_ctrl_x,ts_ctrl_y,ts_ctrl_x-d,ts_ctrl_y+f,ts_slpe_x-d,ts_slpe_y+f);a.lineTo(a_max_x-b,y+c/2);a.lineTo(bs_slpe_x-d,bs_slpe_y-f);a.bezierCurveTo(bs_ctrl_x-d,bs_ctrl_y-f,bs_ctrl_x,bs_ctrl_y,bs_slpe_x,bs_slpe_y)}});function genbank(a,b){for(var c=a.split("\n"),d=new RegExp(/\s+gene\s+([a-z]*)\(?(\d+)\.\.(\d+)/),f=[],e=void 0,g=void 0,h=0;h<c.length;h++){var k;if(k=c[h].match(d)){k.shift();f.push(k);var m=k[2];if(void 0==e||e>m)e=m;k=k[1];if(void 0==g||g<k)g=k}}b.scale.max=e;b.scale.min=g;for(c=0;c<f.length;c++)d="+","complement"==f[c][0]&&(d="-"),k=f[c][1],m=f[c][2],k=k-1+1,b.addGene(k,m-k,d)};function bed(a,b){var c=a.split("\n");numFeatures=c.length;for(var d=1;d<numFeatures&&""!=c[d];d++)for(var f=c[d].split(" "),e=parseInt(f[1]),g=parseInt(f[2]),h=f[0]+": "+f[3],k=f[5],m=f[8],n=f[10].split(","),f=f[11].split(","),e=b.addFeature(new Complex("complex",e,g,k,[],{color:m,name:h})),g=0;g<n.length&&""!=n[g];g++)e.addSubFeature(new BlockArrow("complex",parseInt(f[g]),parseInt(n[g]),k))};
